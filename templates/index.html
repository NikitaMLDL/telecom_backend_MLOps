<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <title>–ö–æ–º–∞–Ω–¥–∞ ‚Ññ6. IThub University</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../static/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>

<div id="snow"></div>

<header class="header">
    <div class="logo">
        <img src="../static/assets/new_logo.svg" alt="logo" class="logo-img">
        <span>| &nbsp;–ö–æ–º–∞–Ω–¥–∞ ‚Ññ6. –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞.</span>
    </div>
</header>

<main class="chat-wrapper">

    <!-- –ü–†–û–ö–†–£–ß–ò–í–ê–ï–ú–ê–Ø –û–ë–õ–ê–°–¢–¨ -->
    <div class="chat-scroll">

        <div class="chat">

            <!-- —Å–æ–æ–±—â–µ–Ω–∏–µ –±–æ—Ç–∞ -->
            <div class="msg bot fade-in">
                <div class="avatar bot-avatar">üéÖ</div>
                <div class="bubble">
                    –ü—Ä–∏–≤–µ—Ç! –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª, –∏ —è —Å–¥–µ–ª–∞—é –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ, –æ–±—ä—è—Å–Ω—é –ø—Ä–∏—á–∏–Ω—ã –∏ –ø—Ä–µ–¥–ª–æ–∂—É —Å—Ç—Ä–∞—Ç–µ–≥–∏—é —É–¥–µ—Ä–∂–∞–Ω–∏—è üéÑ‚ú®
                </div>
            </div>

            <!-- —Ñ–æ—Ä–º–∞ –∑–∞–≥—Ä—É–∑–∫–∏ -->
            <div class="msg bot fade-in">
                <div class="avatar bot-avatar">üéÅ</div>
                <div class="bubble">
                    <form action="/predict" method="post" enctype="multipart/form-data" class="upload-form">
                        <input type="file" name="file" class="file-input" required>
                        <button type="submit" class="send-btn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å üéÅ</button>
                    </form>
                </div>
            </div>

            {% if preview %}
            <!-- –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä -->
            <div class="msg bot fade-in">
                <div class="avatar bot-avatar">‚ùÑÔ∏è</div>
                <div class="bubble">
                    <b>–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö:</b><br><br>

                    <div class="table-wrapper">
                        <table class="preview-table">
                            <tr>
                                {% for col in preview[0].keys() %}
                                    <th>{{ col }}</th>
                                {% endfor %}
                            </tr>

                            {% for row in preview %}
                            <tr>
                                {% for col in row.values() %}
                                    <td>{{ col }}</td>
                                {% endfor %}
                            </tr>
                            {% endfor %}
                        </table>
                    </div>
                    <div class="chat-actions-row">
                        <button type="button" class="send-btn send-btn--outline" onclick="dashboard.open()">
                            üìä –û—Ç–∫—Ä—ã—Ç—å –∞–Ω–∞–ª–∏—Ç–∏–∫—É
                        </button>
                        <a href="{{ download_url }}" class="download-link download-link--right">
                            ‚¨á –°–∫–∞—á–∞—Ç—å –ø–æ–ª–Ω—ã–π CSV
                        </a>
                    </div>
                </div>
            </div>
            {% endif %}

            {% if recommendations %}
            <div class="msg bot fade-in">
                <div class="avatar bot-avatar">üéÑ</div>
                <div class="bubble">
                    <b>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–¥–µ—Ä–∂–∞–Ω–∏—é –∫–ª–∏–µ–Ω—Ç–æ–≤:</b><br><br>
                    {{ recommendations | safe }}
                </div>
            </div>
            {% endif %}
            
            <!-- typing animation -->
            <div class="msg bot typing" id="typing-indicator">
                <div class="avatar bot-avatar">ü§ñ</div>
                <div class="bubble typing-bubble">
                    <span class="dot"></span>
                    <span class="dot"></span>
                    <span class="dot"></span>
                </div>
            </div>

        </div>
    </div>
</main>

<footer class="footer">
    <div class="footer-content">
        <img src="../static/assets/ithub.jpg" alt="IThub" class="footer-logo">
        <p>IThub University ¬© 2025</p>
    </div>
    <p>Built with ‚ù§Ô∏è by Abramov ‚Ä¢ Mukhovikov ‚Ä¢ Yazdanova</p>
</footer>
<div id="dashboardOverlay" class="dash-overlay" aria-hidden="true" style="display: none;">
    <div class="dash-modal" role="dialog" aria-modal="true" aria-label="Dashboard">
        <div class="dash-header">
            <div class="dash-title">
                üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞: <span id="dash-filename" style="opacity: 0.8; font-weight: 400;">{{ uploaded_filename if uploaded_filename else '–ó–∞–≥—Ä—É–∑–∫–∞...' }}</span>
            </div>
            <button type="button" class="dash-close" aria-label="–ó–∞–∫—Ä—ã—Ç—å" onclick="dashboard.close()">√ó</button>
        </div>

        <div class="dash-body">
            <!-- KPI Metrics -->
            <div class="dash-kpi">
                <div class="kpi-card">
                    <div class="kpi-label">–í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π</div>
                    <div class="kpi-value" id="kpi-rows">{{ preview|length if preview else '-' }}</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">–ü—Ä–æ–≥–Ω–æ–∑ –æ—Ç—Ç–æ–∫–∞</div>
                    <div class="kpi-value" id="kpi-churn">-</div>
                </div>
            </div>

            <!-- Charts Grid (2 columns) -->
            <div class="dash-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 20px;">
                
                <!-- 1. Churn Ratio -->
                <div class="dash-card">
                    <div class="dash-card-title">–î–æ–ª—è –æ—Ç—Ç–æ–∫–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤</div>
                    <div class="chart-wrapper" style="height: 300px; position: relative;">
                        <canvas id="chart1_Ratio"></canvas>
                    </div>
                </div>

                <!-- 2. International Plan -->
                <div class="dash-card">
                    <div class="dash-card-title">–í–ª–∏—è–Ω–∏–µ –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–æ–≥–æ —Ç–∞—Ä–∏—Ñ–∞</div>
                    <div class="chart-wrapper" style="height: 300px; position: relative;">
                        <canvas id="chart2_Intl"></canvas>
                    </div>
                </div>

                <!-- 3. Voice Mail Plan -->
                <div class="dash-card">
                    <div class="dash-card-title">–í–ª–∏—è–Ω–∏–µ –≥–æ–ª–æ—Å–æ–≤–æ–π –ø–æ—á—Ç—ã</div>
                    <div class="chart-wrapper" style="height: 300px; position: relative;">
                        <canvas id="chart3_VMail"></canvas>
                    </div>
                </div>

                <!-- 4. Calls -->
                <div class="dash-card">
                    <div class="dash-card-title">–ó–≤–æ–Ω–∫–∏ –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É (–£—à–µ–¥—à–∏–µ)</div>
                    <div class="chart-wrapper" style="height: 300px; position: relative;">
                        <canvas id="chart4_Calls"></canvas>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>

<!-- {% include 'dashboard.html' %}  -->
<script>
    window.SERVER_DATA = {{ dashboard_data | safe if dashboard_data else 'null' }};
</script>

<script src="../static/dashboard.js"></script>
</body>
</html>
